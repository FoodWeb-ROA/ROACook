# ROACook Issues\n\n## Issue 1: Supabase Write Errors (Schema Mismatch & Ambiguous Join)\n\n**Reported:** 2024-07-26\n\n**Error Logs:**\n```\n(NOBRIDGE) ERROR  Error inserting preparation details: {\"code\": \"PGRST204\", \"details\": null, \"hint\": null, \"message\": \"Could not find the \'num_servings\' column of \'preparations\' in the schema cache\"}\n(NOBRIDGE) ERROR  Error checking preparation name: {\"code\": \"PGRST201\", ..., \"message\": \"Could not embed because more than one relationship was found for \'ingredients\' and \'preparations\'\"}\n```\n\n**Analysis:**\n1.  The code in `CreateRecipeScreen.tsx` (`savePrepLogic`, `createNewPreparation`) was attempting to write to a `num_servings` and `serving_size` field in the `preparations` table, which does not exist according to the schema definition found in migrations. These fields belong to the `dishes` table.\n2.  The `checkPreparationNameExists` function in `src/data/dbLookup.ts` was using an implicit join (`preparations(preparation_id)`) which was ambiguous due to multiple potential relationships between `ingredients` and `preparations` tables.\n3.  Minor linter errors were present in `CreateRecipeScreen.tsx` related to a redundant code block and an incorrect `kitchen_id` assignment.\n\n**Attempted Fixes (2024-07-26):**\n1.  **`CreateRecipeScreen.tsx`:**\n    *   Removed `num_servings` and `serving_size` fields from `.update()` and `.insert()` calls targeting the `preparations` table within `savePrepLogic` and `createNewPreparation`.\n    *   Removed a redundant `if (isUpdating)` block that contained incorrect logic for `componentsToSave`.\n    *   Removed `kitchen_id: activeKitchenId` from the object pushed into `componentsToSave` within the component processing loop (as it doesn't belong to `dish_components` or `preparation_ingredients`).\n2.  **`src/data/dbLookup.ts`:**\n    *   Modified the Supabase query within `checkPreparationNameExists` to use an explicit inner join hint: `.select(\`ingredient_id, preparations!inner(preparation_id)\`)` to resolve the relationship ambiguity.\n\n**Status:** Attempted Fix 